---
layout: post
title: 企鹅实习生笔试总结（cont.）
categories:
- internship
---

jerboa：昨天参加了企鹅的实习生笔试，我觉得自己的基础还是不够好。继续打补丁吧！

**1 OS相关的题目**

**1.1 ls命令使用到的syscalls**

> 原题是：*“ ls命令使用了哪些系统调用？ A. read  B. open c. fork  d. mmap ”*

这题考察了shell的内建命令和外部命令。

网络摘抄：  
*Linux命令的执行必须依赖于Shell命令解释器。Shell实际上是在Linux系统中运行的一种特殊程序，它位于操作系统内核与用户之间，负责接受用户输入的命令并进行解释，将需要执行的操作传递给系统内核执行，Shell在用户和内核之间充当了一个“翻译官”的角色。当用户登陆到Linun系统时，会自动加载一个Shell程序，以便给用户提供可以输入命令的操作环境。
Bash是Linux系统中默认使用的Shell程序，文件位于/bin/bash。*

根据Linux命令与Shell程序的关系，一般分为以下3种类型：  

**内建命令**：
内建命令就是由Shell本身所执行的命令。  
指的是集成于Shell解释器程序（如Bash）内部的一些特殊指令，也成为内建（Built-IN)指令。内部命令属于Shell的一部分，所以并没有单独对应的系统文件，只要Shell解释器被运行，内部指令也就自动载入内存了，用户可以直接使用。内部命令无需从硬盘中重新读取文件，因此执行效率更高

**外部命令**：
指的是Linux系统中能够完成特定功能的脚本文件或二进制程序，每个外部命令对应了系统中的一个文件，是属于Shell解释器程序之外的命令，所以称为外部命令。Linux系统必须知道外部命令对应的文件位置，才能够由Shell加载并执行。  
Linux系统默认会将存放外部命令、程序的目录（如/bin、/usr/bin、/usr/local/bin等）添加到用户的“搜索路径”中，当使用位于这些目录中的外部命令时，用户不需要指定具体的位置。因此在大多数情况下，不用刻意去分辨内部、外部命令，其使用方法是基本类似的。

**shell函数**：
Shell函数是功能健全的一系列程序代码，以Shell语言写成，它们可以像命令那样引用。

如何分辨内部、外部命令？

*使用type可以查看是否是内建命令:  
type (不带参数)会显示命令是内建命令还是外部命令  
-t :file 外部命令;alias 命令别名;builtin 内置命令  
-a :会将命令PATH路径显示出来*  
*使用sudo XXX，如sudo ls。原因是，build-in 命令不能用 sudo ...例如 cd 命令。*

**用户在命令行输入命令后，一般情况下外部命令Shell会fork并exec该命令，但是Shell的内建命令例外，执行内建命令相当于调用Shell进程中的一个函数，并不创建新的进程。**

这篇文章展示了ls的实现，调用了哪些syacalls[ls的实现](http://www.cppblog.com/momoxiao/archive/2010/04/04/111594.html)。

假设当前目录在ext2文件系统上，ls要查看当前目录下的文件，归纳下ls执行的整个流程：

- open打开当前目录的句柄，这个句柄对应内核中一个file结构。
   file结构中的file_operations函数集从inode结构中获得，就是ext2_file_operations
- getdents64调用file->f_op->readdir()实际上是调用了ext2_file_operations中的readdir()，
   由ext2文件系统驱动读取当前目录下面的文件项。

我们要隐藏一个文件，要做的就是替换file->f_op->readdir()，也就是替换ext2_file_operations中的readdir()。